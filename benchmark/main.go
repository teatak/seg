package main

import (
	"bufio"
	"fmt"
	"os"
	"strings"
	"time"

	"github.com/teatak/seg/crf"
	"github.com/teatak/seg/dictionary"
	"github.com/teatak/seg/segmenter"
)

// 200 High-quality benchmark sentences covering various domains and edge cases.
var testSentences = []string{
	// --- Technology & AI (20) ---
	"人工智能技术正在深刻改变人类社会的生产生活方式。",
	"深度学习算法需要大量的算力支持和高质量的数据集。",
	"OpenAI发布的GPT-4模型在自然语言处理任务上表现惊人。",
	"区块链技术的去中心化特性为金融安全提供了新的解决方案。",
	"元宇宙概念的兴起带动了虚拟现实（VR）和增强现实（AR）产业的发展。",
	"云计算平台AWS和Azure占据了全球大部分的市场份额。",
	"Python已经成为数据科学和机器学习领域的首选编程语言。",
	"谷歌的Transformer架构彻底改变了NLP领域的研究方向。",
	"量子计算的突破将对现有的加密算法构成巨大挑战。",
	"自动驾驶汽车的普及需要解决法律伦理和技术安全等多重问题。",
	"微服务架构使得大型互联网应用的维护和扩展变得更加容易。",
	"GitHub Copilot利用AI技术帮助程序员提高编写代码的效率。",
	"Web3.0致力于构建一个更加开放和用户主导的互联网生态。",
	"半导体芯片制造工艺已经逼近物理极限，摩尔定律面临失效。",
	"SpaceX的星舰飞船试图实现人类移民火星的宏伟愿景。",
	"边缘计算将数据处理能力下沉到网络边缘，降低了延迟。",
	"5G网络的普及将加速物联网设备的互联互通。",
	"生成式对抗网络（GAN）可以创造出逼真的虚假图像。",
	"自然语言理解（NLU）是实现智能人机交互的关键技术。",
	"Rust语言因其内存安全性正在操作系统开发中受到青睐。",

	// --- E-commerce & Customer Service (20) ---
	"亲，您的快递已经发货了，请注意查收哦。",
	"这款连衣裙采用纯棉面料，透气性好，非常适合夏天穿着。",
	"双十一购物狂欢节期间，全场商品打五折，仅限当天。",
	"如果您对商品不满意，我们支持七天无理由退货。",
	"京东物流的速度一直是我们信赖的首选，第二天就能送到。",
	"拼多多的百亿补贴活动确实让很多农产品走进了千家万户。",
	"这个吸尘器的吸力很大，噪音却很小，性价比超高。",
	"请问这款手机贴膜是钢化膜还是水凝膜？",
	"唯品会主打品牌特卖，经常能淘到便宜的好货。",
	"淘宝直播带货已经成为商家获取流量的重要渠道。",
	"客服小姐姐的态度非常好，耐心地解答了我的所有问题。",
	"差评！包装破损严重，里面的东西都漏出来了。",
	"买一送一的活动真实有效，我和朋友一人一件。",
	"这款洗面奶温和不刺激，敏感肌也可以放心使用。",
	"加上满减优惠券和红包，最后实付价格非常划算。",
	"很多网红推荐的产品其实质量一般，大家要擦亮眼睛。",
	"跨境电商让我们可以方便地买到国外的优质商品。",
	"虽然价格有点贵，但是一分钱一分货，品质没得说。",
	"请把发票和保修卡一起寄给我，谢谢。",
	"由于库存紧张，您的订单可能会延迟发货，请谅解。",

	// --- Travel & Hotel (20) ---
	"丽怡酒店的价格是否包含早餐是很多商务旅客关心的问题。",
	"我们计划今年暑假去云南大理和丽江玩一圈。",
	"请问从机场到希尔顿酒店怎么走最方便？",
	"这家民宿的装修风格非常有特色，就在西湖边上。",
	"去西藏旅游需要提前服用红景天预防高原反应。",
	"携程网提供的机票加酒店套餐比单独预订要便宜不少。",
	"马尔代夫是很多新人度蜜月的首选目的地。",
	"入住全季酒店需要出示身份证并进行人脸识别。",
	"故宫博物院的门票非常抢手，建议提前在网上预约。",
	"北京环球影城的哈利波特园区还原度非常高。",
	"这趟高铁是从上海虹桥出发，终点站是北京南站。",
	"我们在爱彼迎上订的公寓可以直接看到东方明珠塔。",
	"如果您想体验地道的成都生活，一定要去宽窄巷子坐坐。",
	"如家快捷酒店的卫生状况和隔音效果有时候不太理想。",
	"万豪国际集团旗下拥有丽思卡尔顿、喜来登等多个品牌。",
	"这次旅行最遗憾的是没有吃到正宗的长沙臭豆腐。",
	"请问前台可以帮忙叫一辆去火车站的出租车吗？",
	"亚特兰蒂斯酒店的水族馆非常壮观，适合带孩子去。",
	"我们在飞猪上抢到了特价机票，往返才一千块。",
	"旅游保险可以在旅途中遇到意外时提供必要的保障。",

	// --- Finance & Economy (20) ---
	"美联储的加息政策导致全球股市出现了剧烈的波动。",
	"通货膨胀率居高不下，老百姓的生活成本显著增加。",
	"指数基金定投是一种适合大多数人的长期投资策略。",
	"房地产市场的调控政策对房价产生了深远的影响。",
	"蚂蚁集团的IPO暂停事件引起了金融圈的广泛关注。",
	"巴菲特的价值投资理念强调买入并长期持有优质公司。",
	"数字人民币的试点推广将对支付行业产生重大影响。",
	"供应链金融可以帮助中小企业解决融资难的问题。",
	"近期黄金价格持续上涨，引发了投资者的避险情绪。",
	"纳斯达克指数主要反映了科技股的市场表现。",
	"风险投资机构（VC）主要关注初创企业的成长潜力。",
	"银行理财产品的收益率已经不再是刚性兑付了。",
	"注册制改革是中国资本市场的一项重大制度创新。",
	"反垄断调查对互联网巨头的扩张模式构成了约束。",
	"绿色金融致力于支持环保和可持续发展的项目。",
	"跨境支付结算系统的效率直接影响国际贸易的便利性。",
	"个人所得税的专项附加扣除减轻了工薪阶层的负担。",
	"私募基金的门槛较高，只面向合格投资者募集。",
	"宏观经济数据的发布通常会引起汇率市场的波动。",
	"区块链去中心化金融（DeFi）面临着监管合规的挑战。",

	// --- Literature & Prose (20) ---
	"落霞与孤鹜齐飞，秋水共长天一色。",
	"生活不止眼前的苟且，还有诗和远方。",
	"那一年，花开得不是最好，可是还好，我遇到你。",
	"命运赠送的礼物，早已在暗中标好了价格。",
	"各种颜色的皮肤，各种颜色的头发，嘴里念的说的开始流行中国话。",
	"我们终此一生，就是要摆脱他人的期待，找到真正的自己。",
	"月光如流水一般，静静地泻在这一片叶子和花上。",
	"轻轻的我走了，正如我轻轻的来；我轻轻的招手，作别西天的云彩。",
	"黑夜给了我黑色的眼睛，我却用它寻找光明。",
	"人生由淡淡的悲伤和淡淡的幸福组成。",
	"且将新火试新茶，诗酒趁年华。",
	"大江东去，浪淘尽，千古风流人物。",
	"世界上只有一种英雄主义，就是看清生活的真相之后依然热爱生活。",
	"你的负担将变成礼物，你受的苦将照亮你的路。",
	"一花一世界，一叶一菩提。",
	"众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。",
	"由于性格的差异，他们最终还是分道扬镳了。",
	"时间像海绵里的水，只要愿挤，总还是有的。",
	"真的猛士，敢于直面惨淡的人生，敢于正视淋漓的鲜血。",
	"海内存知己，天涯若比邻。",

	// --- Address & Location (20) ---
	"四川省成都市高新区天府大道北段1700号环球中心E2区",
	"北京市海淀区中关村南大街5号理工大学求是楼",
	"上海市浦东新区张江高科技园区祖冲之路10号",
	"广东省深圳市南山区粤海街道科技园社区深南大道9996号",
	"浙江省杭州市余杭区文一西路969号阿里巴巴西溪园区",
	"江苏省南京市鼓楼区汉口路22号南京大学鼓楼校区",
	"湖北省武汉市洪山区珞喻路1037号华中科技大学",
	"陕西省西安市长安区郭杜教育科技产业开发区文苑南路",
	"福建省厦门市思明区思明南路422号厦门大学",
	"湖南省长沙市岳麓区麓山南路932号中南大学",
	"山东省青岛市崂山区松岭路238号中国海洋大学",
	"安徽省合肥市包河区金寨路96号中国科学技术大学",
	"黑龙江省哈尔滨市南岗区西大直街92号哈尔滨工业大学",
	"辽宁省沈阳市和平区文化路3号东北大学",
	"吉林省长春市朝阳区前进大街2699号吉林大学",
	"重庆市沙坪坝区沙正街174号重庆大学",
	"云南省昆明市呈贡区景明南路727号昆明理工大学",
	"贵州省贵阳市花溪区花溪大道南段贵州大学",
	"广西壮族自治区南宁市西乡塘区大学东路100号广西大学",
	"新疆维吾尔自治区乌鲁木齐市新市区科学一街399号",

	// --- Legal & Medical (20) ---
	"根据《中华人民共和国刑法》第二百三十二条的规定。",
	"患者主诉胸闷气短，伴有持续性咳嗽和低热症状。",
	"本合同自双方签字盖章之日起生效，有效期为一年。",
	"由于证据不足，检察院决定不予起诉。",
	"急性心肌梗死需要立即进行冠状动脉介入治疗（PCI）。",
	"知识产权保护是激励创新的法律基石。",
	"服用本品期间请勿饮酒，以免引起双硫仑样反应。",
	"被告人对起诉书指控的犯罪事实供认不讳。",
	"糖尿病患者需要严格控制饮食中的糖分摄入。",
	"不可抗力是指不能预见、不能避免并不能克服的客观情况。",
	"这种药物的副作用包括恶心、呕吐和头晕。",
	"根据各方当事人的陈述和提供的证据，法庭认定如下事实。",
	"过敏性鼻炎在春季花粉浓度高的时候容易发作。",
	"法人是具有民事权利能力和民事行为能力，依法独立享有民事权利和承担民事义务的组织。",
	"微创手术具有创伤小、恢复快、疼痛轻等优点。",
	"劳动者享有平等就业和选择职业的权利。",
	"核磁共振成像（MRI）检查对软组织病变的诊断价值较高。",
	"在法律面前人人平等，任何人都没有超越法律的特权。",
	"长期熬夜会增加患心脑血管疾病的风险。",
	"法院判决驳回原告的全部诉讼请求。",

	// --- Ambiguity & Edge Cases (20) ---
	"乒乓球拍卖完了",              // 乒乓球拍 | 卖 | 完了
	"南京市长江大桥",              // 南京市 | 长江大桥
	"结婚的和尚未结婚的",            // 结婚 | 的 | 和 | 尚未 | 结婚 | 的
	"下雨天留客天留我不留",           // 下雨天 | 留客 | 天 | 留 | 我 | 不 | 留
	"项目部落实了责任制",            // 项目 | 部落实 | 了 | 责任制 (Error) -> 项目部 | 落实 | 了
	"美国会通过对台军售法案",          // 美国 | 会 | 通过 (Error) -> 美 | 国会 | 通过
	"我来到北京清华大学",            // 我 | 来到 | 北京 | 清华大学
	"他拥有很多fans",            // 他 | 拥有 | 很多 | fans (English mixing)
	"iPhone15ProMax的价格是多少", // iPhone15ProMax | 的 | 价格
	"C++是世界上最难学的语言之一",      // C++ | 是
	"哆啦A梦的口袋里有什么",          // 哆啦A梦
	"T恤的尺码稍微有点大",           // T恤
	"Wi-Fi信号不太好",           // Wi-Fi
	"这个bug很难复现",            // bug
	"我们需要100%的努力",          // 100%
	"2023年10月1日是国庆节",       // 2023年 | 10月 | 1日
	"你好世界Hello World",      // 你好 | 世界 | Hello | World
	"工信处女干事每月经过下属科室",       // 工信处 | 女干事 (Classic ambiguity)
	"无线电法国别研究",             // 无线电 | 法国 | 别 ? -> 无线电法 | 国别 | 研究
	"人生活着就是为了改变世界",         // 人生 | 活着 ? -> 人 | 生活 | 着 ?

	// --- Short Phrases & Idioms (20) ---
	"画蛇添足",
	"守株待兔",
	"掩耳盗铃",
	"刻舟求剑",
	"自相矛盾",
	"滥竽充数",
	"亡羊补牢",
	"井底之蛙",
	"邯郸学步",
	"东施效颦",
	"卧薪尝胆",
	"纸上谈兵",
	"各种各样",
	"成千上万",
	"不可思议",
	"莫名其妙",
	"欣欣向荣",
	"蒸蒸日上",
	"一丝不苟",
	"全心全意",

	// --- Names & Entities (20) ---
	"马云创办了阿里巴巴",
	"李彦宏是百度的创始人",
	"马化腾的腾讯公司推出了微信",
	"雷军的小米手机主打性价比",
	"董明珠带领格力电器走向世界",
	"任正非的华为公司在5G领域领先",
	"王兴的美团改变了人们的吃饭方式",
	"张一鸣的字节跳动拥有抖音和TikTok",
	"丁磊的网易游戏非常赚钱",
	"刘强东的京东物流速度很快",
	"周杰伦的歌曲陪伴了一代人的青春",
	"成龙是国际著名的动作影星",
	"姚明是中国篮球的骄傲",
	"刘慈欣的《三体》获得了雨果奖",
	"莫言是首位获得诺贝尔文学奖的中国籍作家",
	"钟南山院士在抗击疫情中做出了巨大贡献",
	"袁隆平被誉为“杂交水稻之父”",
	"屠呦呦发现了青蒿素",
	"张艺谋导演的电影画面非常精美",
	"郭德纲的相声给大家带来了很多欢乐",
}

func main() {
	// 加载资源
	fmt.Println("正在加载资源...")
	dict := dictionary.NewDictionary()
	if err := dict.Load("data/dictionary.txt"); err != nil {
		fmt.Printf("Error loading dictionary: %v\n", err)
		return
	}
	seg := segmenter.NewSegmenter(dict)

	model := crf.NewModel()
	if err := model.Load("data/crf_model.txt"); err == nil {
		seg.CRFModel = model
	} else {
		fmt.Println("Warning: Could not load CRF model.")
	}

	fmt.Printf("已准备 %d 个高难度测试句，覆盖电商、科技、医疗、地址、歧义等多个领域。\n", len(testSentences))

	// 准备报告文件
	reportFile, _ := os.Create("benchmark/test_report.md")
	defer reportFile.Close()
	w := bufio.NewWriter(reportFile)

	fmt.Fprintf(w, "# Segmentation Benchmark Report (Comprehensive)\n\n")
	fmt.Fprintf(w, "- **Date**: %s\n", time.Now().Format(time.RFC3339))
	fmt.Fprintf(w, "- **Mode**: Hybrid\n")
	fmt.Fprintf(w, "- **Total Sentences**: %d\n\n", len(testSentences))
	fmt.Fprintf(w, "| ID | Original Text | Segmentation Result |\n")
	fmt.Fprintf(w, "|----|---------------|---------------------|\n")

	start := time.Now()
	for i, sent := range testSentences {
		// 使用 Hybrid 模式
		res := seg.Cut(sent, segmenter.ModeHybrid)

		// 格式化输出
		outStr := strings.Join(res, " / ")
		outStr = strings.ReplaceAll(outStr, "\n", "") // 清理换行

		fmt.Fprintf(w, "| %d | %s | `%s` |\n", i+1, sent, outStr)

		// 简单的控制台进度
		if i > 0 && i%20 == 0 {
			fmt.Printf("Processed %d/%d...\n", i, len(testSentences))
		}
	}
	elapsed := time.Since(start)

	fmt.Fprintf(w, "\n## Performance\n")
	fmt.Fprintf(w, "- **Total Time**: %v\n", elapsed)
	if len(testSentences) > 0 {
		fmt.Fprintf(w, "- **Avg Time per Sentence**: %v\n", elapsed/time.Duration(len(testSentences)))
	}

	w.Flush()
	fmt.Printf("\nDone! Report saved to benchmark/test_report.md\n")
}
